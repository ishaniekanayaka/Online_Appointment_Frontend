<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Freelancer Gig Registration</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.css">
    <!-- Custom CSS -->
    <style>
        :root {
            --primary-color: #6366f1;
            --primary-hover: #4f46e5;
            --secondary-color: #f9fafb;
            --dark-color: #1f2937;
            --light-color: #f3f4f6;
        }
        
        body {
            background-color: #f9fafb;
            color: #1f2937;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .form-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        
        .form-header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            padding: 2rem;
            color: white;
        }
        
        .form-body {
            padding: 2rem;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(99, 102, 241, 0.25);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover, .btn-primary:focus {
            background-color: var(--primary-hover);
            border-color: var(--primary-hover);
        }
        
        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .file-upload {
            position: relative;
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            border: 2px dashed #e5e7eb;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .file-upload:hover {
            border-color: var(--primary-color);
        }
        
        .file-preview {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            background-color: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .file-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .icon-box {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background-color: #f3f4f6;
            color: var(--primary-color);
            margin-right: 0.75rem;
        }
        
        .floating-label {
            position: relative;
        }
        
        .floating-label label {
            position: absolute;
            top: -12px;
            left: 10px;
            background-color: white;
            padding: 0 5px;
            font-size: 0.875rem;
            color: #6b7280;
            z-index: 1;
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        
        .step-number {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #e5e7eb;
            color: #6b7280;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 0.5rem;
            z-index: 2;
        }
        
        .step-title {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .step.active .step-number {
            background-color: var(--primary-color);
            color: white;
        }
        
        .step.active .step-title {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .step-line {
            position: absolute;
            top: 18px;
            left: 50%;
            width: 100%;
            height: 2px;
            background-color: #e5e7eb;
            z-index: 1;
        }
        
        .step:first-child .step-line {
            display: none;
        }
        
        .bg-pattern {
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 300px;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.2'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.5;
            z-index: 0;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="form-container">
                    <div class="form-header position-relative">
                        <div class="bg-pattern"></div>
                        <div class="position-relative">
                            <h1 class="display-6 fw-bold mb-2">Showcase Your Talent</h1>
                            <p class="lead mb-0">Register your professional gig and start earning</p>
                        </div>
                    </div>
                    
                    <div class="form-body">
                        <form id="gigForm" enctype="multipart/form-data">
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="file-upload mb-4">
                                        <div class="file-preview" id="imagePreview">
                                            <i class="bi bi-person-circle" style="font-size: 2rem; color: #9ca3af;"></i>
                                        </div>
                                        <div>
                                            <h5 class="mb-1">Upload Profile Image</h5>
                                            <p class="text-muted small mb-2">Drag & drop your photo or click to browse</p>
                                            <input type="file" class="form-control" id="image" name="image" required accept="image/*">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row g-4">
                                <!-- Personal Information -->
                                <div class="col-md-6">
                                    <div class="floating-label mb-3">
                                        <label for="FullName">Full Name</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-person"></i></span>
                                            <input type="text" class="form-control" id="FullName" name="FullName" required>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="floating-label mb-3">
                                        <label for="contactNumber">Contact Number</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-telephone"></i></span>
                                            <input type="text" class="form-control" id="contactNumber" name="contactNumber" required>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="floating-label mb-3">
                                        <label for="degree">Qualification/Degree</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-mortarboard"></i></span>
                                            <input type="text" class="form-control" id="degree" name="degree" required>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="floating-label mb-3">
                                        <label for="experience">Experience</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-briefcase"></i></span>
                                            <input type="text" class="form-control" id="experience" name="experience" required placeholder="e.g. 5 years">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Service Details -->
                                <div class="col-md-6">
                                    <div class="floating-label mb-3">
                                        <label for="amountCharge">Charge Amount ($)</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-currency-dollar"></i></span>
                                            <input type="number" class="form-control" id="amountCharge" name="amountCharge" required min="1" step="0.01">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="floating-label mb-3">
                                        <label for="location">Location</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-geo-alt"></i></span>
                                            <input type="text" class="form-control" id="location" name="location" required>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="floating-label mb-3">
                                        <label for="maxAppointmentsPerDay">Max Appointments Per Day</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-calendar-check"></i></span>
                                            <input type="number" class="form-control" id="maxAppointmentsPerDay" name="maxAppointmentsPerDay" required min="1">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="floating-label mb-3">
                                        <label for="dateTime">Available From</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-clock"></i></span>
                                            <input type="datetime-local" class="form-control" id="dateTime" name="dateTime">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- System Details -->
                                <div class="col-md-6">
                                    <div class="floating-label mb-3">
                                        <label for="userId">User ID</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-person-badge"></i></span>
                                            <input type="number" class="form-control" id="userId" name="userId" required>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="floating-label mb-3">
                                        <label for="subCategoryId">Service Category</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-tag"></i></span>
                                            <input type="number" class="form-control" id="subCategoryId" name="subCategoryId" required>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-12">
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="active" name="active" checked>
                                        <label class="form-check-label" for="active">Make this gig active immediately</label>
                                    </div>
                                </div>
                                
                                <div class="col-12 text-center mt-4">
                                    <button type="submit" class="btn btn-primary btn-lg px-5">
                                        <i class="bi bi-check-circle me-2"></i> Register Gig
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            checkAuth();  // Make sure the user is authenticated
            
            // Image preview
            document.getElementById('image').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const preview = document.getElementById('imagePreview');
                        preview.innerHTML = `<img src="${e.target.result}" alt="Profile Preview">`;
                    }
                    reader.readAsDataURL(file);
                }
            });
        });

        const BASE_URL = "http://localhost:8080/api/v1/gig";
        const AUTH_TOKEN = localStorage.getItem('authToken');

        // ✅ Check Authentication
        function checkAuth() {
            if (!AUTH_TOKEN) {
                Swal.fire({
                    title: 'Authentication Required',
                    text: 'You need to login to register a gig',
                    icon: 'warning',
                    showCancelButton: false,
                    confirmButtonColor: '#6366f1',
                    confirmButtonText: 'Go to Login'
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = '/login.html';
                    }
                });
            }
        }

        // ✅ Headers for API Requests
        function getHeaders(isMultipart = false) {
            return isMultipart ? { 'Authorization': `Bearer ${AUTH_TOKEN}` } : {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${AUTH_TOKEN}`
            };
        }

        // ✅ Save Gig Details
        $('#gigForm').on('submit', function(event) {
            event.preventDefault();

            const formData = new FormData(this);

            // Validate form
            const fullName = $('#FullName').val();
            if (!fullName) {
                Swal.fire({
                    title: 'Warning',
                    text: 'Full Name is required!',
                    icon: 'warning',
                    confirmButtonColor: '#6366f1'
                });
                return;
            }

            // Show loading state
            Swal.fire({
                title: 'Submitting...',
                html: 'Please wait while we register your gig',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            // Send data via AJAX
            $.ajax({
                url: `${BASE_URL}/save`,
                type: 'POST',
                headers: getHeaders(true),
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Gig Registered!',
                        text: response.message || 'Your gig has been successfully registered.',
                        confirmButtonColor: '#6366f1'
                    });
                    clearForm();
                },
                error: function (xhr) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Registration Failed',
                        text: 'Error saving gig details: ' + (xhr.responseJSON?.message || xhr.responseText || 'Unknown error occurred'),
                        confirmButtonColor: '#6366f1'
                    });
                }
            });
        });

        // Clear form after successful submission
        function clearForm() {
            $('#gigForm')[0].reset();
            document.getElementById('imagePreview').innerHTML = '<i class="bi bi-person-circle" style="font-size: 2rem; color: #9ca3af;"></i>';
            window.selectedGigId = null;
        }
    </script>
</body>
</html>