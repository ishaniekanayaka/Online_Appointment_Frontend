<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Save Gig Details</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>
</head>
<body>

    <h2>Gig Details Form</h2>

    <form id="gigForm" enctype="multipart/form-data">
        <label for="FullName">Full Name:</label>
        <input type="text" id="FullName" name="FullName" required><br>

        <label for="image">Image:</label>
        <input type="file" id="image" name="image" required><br>

        <label for="degree">Degree:</label>
        <input type="text" id="degree" name="degree" required><br>

        <label for="experience">Experience:</label>
        <input type="text" id="experience" name="experience" required><br>

        <label for="amountCharge">Amount Charge:</label>
        <input type="number" id="amountCharge" name="amountCharge" required><br>

        <label for="location">Location:</label>
        <input type="text" id="location" name="location" required><br>

        <label for="contactNumber">Contact Number:</label>
        <input type="text" id="contactNumber" name="contactNumber" required><br>

        <label for="maxAppointmentsPerDay">Max Appointments Per Day:</label>
        <input type="number" id="maxAppointmentsPerDay" name="maxAppointmentsPerDay" required><br>

        <label for="active">Active:</label>
        <input type="checkbox" id="active" name="active"><br>

        <label for="dateTime">Date Time:</label>
        <input type="datetime-local" id="dateTime" name="dateTime"><br>

        <label for="userId">User ID:</label>
        <input type="number" id="userId" name="userId" required><br>


        <label for="subCategoryId">Sub Category ID:</label>
        <input type="number" id="subCategoryId" name="subCategoryId" required><br>

        <button type="submit">Submit</button>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            checkAuth();  // Make sure the user is authenticated
        });

        const BASE_URL = "http://localhost:8080/api/v1/gig";
        const AUTH_TOKEN = localStorage.getItem('authToken');

        // ✅ Check Authentication
        function checkAuth() {
            if (!AUTH_TOKEN) {
                Swal.fire('Unauthorized', 'You are not authenticated. Please login.', 'error').then(() => {
                    window.location.href = '/login.html';
                });
            }
        }

        // ✅ Headers for API Requests
        function getHeaders(isMultipart = false) {
            return isMultipart ? { 'Authorization': `Bearer ${AUTH_TOKEN}` } : {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${AUTH_TOKEN}`
            };
        }

        // ✅ Save Gig Details
        $('#gigForm').on('submit', function(event) {
            event.preventDefault();

            const formData = new FormData(this);

            // Check if fullName is provided
            const fullName = $('#FullName').val();
            if (!fullName) {
                Swal.fire('Warning', 'Full Name is required!', 'warning');
                return;
            }

            // Send data via AJAX
            $.ajax({
                url: `${BASE_URL}/save`,  // Update with your actual URL
                type: 'POST',
                headers: getHeaders(true),  // Include Authorization header
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    Swal.fire('Success!', response.message, 'success');
                    clearForm();
                },
                error: function (xhr) {
                    Swal.fire('Error!', 'Error saving gig details: ' + xhr.responseText, 'error');
                }
            });
        });

        // Clear form after successful submission
        function clearForm() {
            $('#gigForm')[0].reset();
            window.selectedGigId = null;
        }
    </script>

</body>
</html>
